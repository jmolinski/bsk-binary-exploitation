FROM ubuntu:20.04

RUN apt-get -y update && DEBIAN_FRONTEND=noninteractive apt-get install -y \
    bison \
    build-essential \
    flex \
    git \
    libnl-route-3-dev \
    libprotobuf-dev \
    libtool \
    pkg-config \
    protobuf-compiler

WORKDIR /
RUN git clone https://github.com/google/nsjail.git

RUN cd /nsjail && make && cd / && cp /nsjail/nsjail /bin && rm -rf -- /nsjail

ADD attack_tree /
ADD flag.txt /flag.txt

EXPOSE 1337
CMD [ "nsjail", "-Q", "-Ml", "--port", "1337", "--chroot", "/", "-u", "65534", "-g", "65534", "--disable_proc", "--", "/attack_tree" ]
